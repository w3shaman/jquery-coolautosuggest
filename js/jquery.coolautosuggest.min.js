(function(a){function b(x,v){var h=x.divId;var p=false;var f=null;var o=v;var m;var j=true;o.after('<div class="'+x.divClass+'" id="'+h+'"></div>');o.attr("autocomplete","off");var n=o.next("#"+h);n.hide();if(x.width==null){x.width=o.width()+3}if(x.idField!=null||x.submitOnSelect==true||x.preventEnter==true){o.keypress(function(z){if(z.keyCode==13){return false}return true})}var l=0;var w=x.rowIdPrefix;var s=x.rowClass;var g=x.rowTextClass;var u="";var y=this;o.keyup(function(A){if(a.inArray(A.keyCode,[37,38,39,40,13,9,16,17,18])==-1){if(a(this).val().length>=x.minChars){u="";if(typeof x.additionalFields=="object"){for(var z in x.additionalFields){u=u+z+encodeURI(x.additionalFields[z].val())}}a.ajax({url:x.url+encodeURI(a(this).val())+u,beforeSend:function(){if(typeof x.onRequest==="function"){x.onRequest.call()}},complete:function(){if(typeof x.onComplete==="function"){x.onComplete.call()}},success:function(D){try{if(typeof D=="string"){f=a.parseJSON(D)}else{if(typeof D=="object"){f=D}}var F=f;var E="";l=0;if(F==null){y.hide()}else{if(F.length>0){for(i=0;i<F.length;i++){cssClass=s;var J=x.template;if(i%2!=0){cssClass+=" even"}else{cssClass+=" odd"}if(i==0){cssClass+=" first"}if(i==(F.length-1)){cssClass+=" last"}J=J.replace(/\[rowClass\]/g,cssClass);var C="";if(x.idField!=null){C=F[i].id}J=J.replace(/\[id_field\]/g,C);var B="";var L="";if(x.showThumbnail==true){if(F[i].thumbnail!=undefined){B="background-image:url("+F[i].thumbnail+");";L=x.rowThumbnailClass}}J=J.replace(/\[style\]/g,B);J=J.replace(/\[thumbnailClass\]/g,L);var G="";var K="";if(x.showDescription==true){if(F[i].description!=undefined){K=x.rowDescriptionClass;G=F[i].description}}J=J.replace(/\[descriptionClass\]/g,K);J=J.replace(/\[description\]/g,G);J=J.replace(/\[rowId\]/g,w+(i+1));J=J.replace(/\[seq_id\]/g,i);J=J.replace(/\[textClass\]/g,g);J=J.replace(/\[text\]/g,F[i].data.replace(new RegExp("("+d(o.val())+")","gi"),"<b>$1</b>"));E+=J}n.html(E);for(i=1;i<=F.length;i++){var I=n.find("#"+w+i);I.bind("touchstart touchend",function(N){p=false;y.unSelectAll(this);var M=a(this);e(M);t()});I.mouseover(function(N){if(j==false){p=true;y.unSelectAll(this);var M=a(this);e(M)}});I.mouseout(function(M){p=false;y.unSelectAll(this)});I.click(function(N){var M=a(this);e(M);r(M);if(typeof x.onSelected=="function"){x.onSelected.call(this,f[M.attr("seq_id")])}t();y.hide()});I.mousemove(function(M){j=false;clearTimeout(m);m=setTimeout(c,200)})}y.show(n.find("."+s).height()*F.length)}else{y.hide()}}}catch(H){if(typeof x.onError==="function"){x.onError.call()}}},error:function(D,B,C){if(typeof x.onError==="function"){x.onError.call()}}})}else{y.hide()}}else{if(n.css("display")!="none"){k(A)}}});o.bind("blur",function(A){if(p==false){if(typeof x.onSelected=="function"){x.onSelected.call(this,null)}}else{var z=n.find("#"+w+l);e(z);r(z);p=false;if(typeof x.onSelected=="function"&&l>0){x.onSelected.call(this,f[l-1])}}y.hide()});a(document).scroll(function(z){q()});this.show=function(z){q();n.css({height:z+"px",width:x.width+"px"});n.find("."+s).css({width:x.width+"px",overflow:"hidden"});n.show()};this.hide=function(){n.hide()};this.unSelectAll=function(C){var B=a(C).attr("id");var A=n.find("."+s).get().length;for(i=1;i<=A;i++){n.find("#"+w+i).removeClass("selected")}l=parseInt(B.replace(w,""));var z=/^[0-9]+$/;if(!z.test(l)){l=0}};this.checkSelected=function(A){if(f!=null){for(var z=0;z<f.length;z++){if(f[z].data==A){return true}}}return false};function k(B){if(n.css("display")!="none"){var z=n.find("."+s).get().length;if(B.keyCode==40){l++;if(l<=z){var A=n.find("#"+w+l);y.unSelectAll(A);e(A)}else{l=z}}else{if(B.keyCode==38){l--;if(l>0){var A=n.find("#"+w+l);y.unSelectAll(A);e(A)}else{l=1}}else{if(B.keyCode==13){var A=n.find("#"+w+l);e(A);r(A);if(typeof x.onSelected=="function"){if(l>0){x.onSelected.call(this,f[l-1])}else{x.onSelected.call(this,null)}}y.hide()}}}}else{if(typeof x.onSelected=="function"){x.onSelected.call(this,null)}}return true}function d(z){return z.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function e(z){z.addClass("selected")}function r(z){o.val(z.find("."+g).text());if(x.idField!=null){x.idField.val(z.attr("id_field"))}}function t(){if(x.submitOnSelect==true){a("form").has(o).submit()}}function c(){j=true}function q(){n.css({position:"fixed",left:(o.offset().left-a(document).scrollLeft())+"px",top:(o.offset().top+o.height()+5-a(document).scrollTop())+"px"})}}a.fn.coolautosuggest=function(c){var d={url:null,width:null,minChars:1,idField:null,submitOnSelect:false,showThumbnail:false,showDescription:false,onSelected:null,onError:function(){alert("Sorry, an error has occured!")},onRequest:null,onComplete:null,preventEnter:false,additionalFields:[],divId:"suggestions_holder",divClass:"suggestions",rowIdPrefix:"suggest_row",rowClass:"suggest_item",rowTextClass:"suggestion_title",rowThumbnailClass:"thumbnail",rowDescriptionClass:"description",template:'<div id="[rowId]" class="[rowClass]" id_field="[id_field]" seq_id="[seq_id]" ><div class="[thumbnailClass]" style="[style]"></div><div class="[textClass]">[text]</div><div class="[descriptionClass]">[description]</div></div>'};a.extend(d,c);return this.each(function(){var e=new b(d,a(this))})}})(jQuery);